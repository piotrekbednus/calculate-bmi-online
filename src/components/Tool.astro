---
interface Props {
  langData: any;
  lang: string;
}

const { langData, lang } = Astro.props;
---

<!-- BMI Calculator Tool -->
<div class="bmi-calculator">
  <div class="unit-toggle">
    <label class="radio-label">
      <input type="radio" name="unit" value="metric" checked id="metricRadio">
      {langData.bmiCalculator.metric}
    </label>
    <label class="radio-label">
      <input type="radio" name="unit" value="imperial" id="imperialRadio">
      {langData.bmiCalculator.imperial}
    </label>
  </div>

  <div class="input-group" id="metricInputs">
    <div class="input-field">
      <label for="weightMetric">{langData.bmiCalculator.weightLabel} (kg)</label>
      <input type="number" id="weightMetric" placeholder="70" min="1" step="0.1">
    </div>
    <div class="input-field">
      <label for="heightMetric">{langData.bmiCalculator.heightLabel} (cm)</label>
      <input type="number" id="heightMetric" placeholder="170" min="1" step="1">
    </div>
  </div>

  <div class="input-group hidden" id="imperialInputs">
    <div class="input-field">
      <label for="weightImperial">{langData.bmiCalculator.weightLabel} (lbs)</label>
      <input type="number" id="weightImperial" placeholder="150" min="1" step="0.1">
    </div>
    <div class="input-field double-input">
      <label>{langData.bmiCalculator.heightLabel}</label>
      <div class="feet-inches">
        <input type="number" id="heightFeet" placeholder="5" min="1" step="1">
        <span>ft</span>
        <input type="number" id="heightInches" placeholder="7" min="0" max="11" step="1">
        <span>in</span>
      </div>
    </div>
  </div>

  <div class="action-buttons">
    <button id="calculateButton">{langData.bmiCalculator.calculateButton}</button>
  </div>

  <div class="result-container hidden" id="resultContainer">
    <div class="bmi-value" id="bmiValue">--</div>
    <div class="bmi-category" id="bmiCategory">--</div>
    <div class="bmi-meter">
      <div class="bmi-fill" id="bmiFill"></div>
    </div>
  </div>
</div>

<script define:vars={{ langData, lang }}>
  window.translations = { [lang]: langData };

  document.addEventListener("DOMContentLoaded", function() {
    const metricRadio = document.getElementById("metricRadio");
    const imperialRadio = document.getElementById("imperialRadio");
    const metricInputs = document.getElementById("metricInputs");
    const imperialInputs = document.getElementById("imperialInputs");
    const calculateButton = document.getElementById("calculateButton");
    const resultContainer = document.getElementById("resultContainer");
    const bmiValue = document.getElementById("bmiValue");
    const bmiCategory = document.getElementById("bmiCategory");
    const bmiFill = document.getElementById("bmiFill");

    // Inputs
    const weightMetric = document.getElementById("weightMetric");
    const heightMetric = document.getElementById("heightMetric");
    const weightImperial = document.getElementById("weightImperial");
    const heightFeet = document.getElementById("heightFeet");
    const heightInches = document.getElementById("heightInches");

    // Toggle units
    function toggleUnits() {
      if (metricRadio.checked) {
        metricInputs.classList.remove("hidden");
        imperialInputs.classList.add("hidden");
      } else {
        metricInputs.classList.add("hidden");
        imperialInputs.classList.remove("hidden");
      }
      resultContainer.classList.add("hidden");
    }

    metricRadio.addEventListener("change", toggleUnits);
    imperialRadio.addEventListener("change", toggleUnits);

    function calculateBMI() {
      let weight, height;
      let bmi = 0;

      if (metricRadio.checked) {
        weight = parseFloat(weightMetric.value);
        height = parseFloat(heightMetric.value);

        if (weight > 0 && height > 0) {
          // BMI = kg / (m * m)
          bmi = weight / ((height / 100) * (height / 100));
        }
      } else {
        weight = parseFloat(weightImperial.value);
        const feet = parseFloat(heightFeet.value) || 0;
        const inches = parseFloat(heightInches.value) || 0;
        const totalInches = (feet * 12) + inches;

        if (weight > 0 && totalInches > 0) {
          // BMI = 703 * lbs / (in * in)
          bmi = 703 * weight / (totalInches * totalInches);
        }
      }

      if (bmi > 0) {
        displayResult(bmi);
      } else {
        alert("Please enter valid values.");
      }
    }

    function displayResult(bmi) {
      const roundedBMI = bmi.toFixed(1);
      bmiValue.textContent = roundedBMI;
      resultContainer.classList.remove("hidden");

      let category = "";
      let color = "";
      let percentage = 0;

      const dict = window.translations[lang].bmiCalculator;

      if (bmi < 18.5) {
        category = dict.underweight;
        color = "#3498db"; // Blue
        percentage = 20;
      } else if (bmi < 25) {
        category = dict.normal;
        color = "#2ecc71"; // Green
        percentage = 50;
      } else if (bmi < 30) {
        category = dict.overweight;
        color = "#f1c40f"; // Yellow
        percentage = 80;
      } else {
        category = dict.obesity;
        color = "#e74c3c"; // Red
        percentage = 100;
      }

      bmiCategory.textContent = category;
      bmiCategory.style.color = color;
      
      bmiFill.style.width = percentage + "%";
      bmiFill.style.backgroundColor = color;
    }

    calculateButton.addEventListener("click", calculateBMI);
  });
</script>

<style>
  .bmi-calculator {
    background-color: #fff;
    border-radius: 10px;
    padding: 2rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
  }

  .unit-toggle {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 2rem;
  }

  .radio-label {
    cursor: pointer;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .input-group {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .input-field {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .input-field label {
    font-weight: bold;
    color: #333;
  }

  .input-field input {
    padding: 12px;
    border: 2px solid #e0e0e0;
    border-radius: 5px;
    font-size: 1rem;
  }

  .double-input .feet-inches {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .double-input input {
    width: 100%;
  }

  .hidden {
    display: none !important;
  }

  .action-buttons {
    text-align: center;
  }

  #calculateButton {
    background-color: #f0a500;
    color: white;
    border: none;
    padding: 15px 40px;
    font-size: 1.2rem;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
    font-weight: bold;
    width: 100%;
  }

  #calculateButton:hover {
    background-color: #d99500;
  }

  .result-container {
    margin-top: 2rem;
    text-align: center;
    padding-top: 1rem;
    border-top: 1px solid #eee;
  }

  .bmi-value {
    font-size: 3rem;
    font-weight: bold;
    color: #333;
  }

  .bmi-category {
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 1rem;
  }

  .bmi-meter {
    height: 15px;
    background-color: #e0e0e0;
    border-radius: 10px;
    overflow: hidden;
    margin-top: 10px;
  }

  .bmi-fill {
    height: 100%;
    width: 0%;
    transition: width 0.5s, background-color 0.5s;
  }
</style>
